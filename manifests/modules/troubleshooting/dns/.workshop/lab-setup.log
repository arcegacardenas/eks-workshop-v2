Sun Nov 10 23:15:16 UTC 2024 - Lab Setup Started
+ special_echo 'Applying configuration!'
+ echo 'Applying configuration!'
++ aws eks describe-addon --cluster-name eks-workshop --addon-name kube-proxy --query addon.configurationValues --region us-west-2 --output text
+ output='{}'
+ [[ {} != \{\} ]]
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{"ipvs": {"scheduler": "r"}, "mode": "ipvs"}' --resolve-conflicts OVERWRITE
{
    "update": {
        "id": "45178be3-e0b1-31e0-b44c-b5cac0ba8f5e",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"ipvs\": {\"scheduler\": \"r\"}, \"mode\": \"ipvs\"}"
            }
        ],
        "createdAt": "2024-11-10T23:15:18.655000+00:00",
        "errors": []
    }
}
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
pod "kube-proxy-fdr78" deleted
pod "kube-proxy-mh8m5" deleted
pod "kube-proxy-vrrtc" deleted
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy
+ kubectl scale deployment coredns --replicas=0 -n kube-system
deployment.apps/coredns scaled
+ sleep 2
+ aws eks update-addon --cluster-name eks-workshop --region us-west-2 --addon-name coredns --resolve-conflicts OVERWRITE --configuration-values '{"nodeSelector":{"workshop-default":"no"},"replicaCount":0}'
{
    "update": {
        "id": "b4a260d1-825f-350e-8188-a0f2a9e79bb5",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"nodeSelector\":{\"workshop-default\":\"no\"},\"replicaCount\":0}"
            }
        ],
        "createdAt": "2024-11-10T23:15:28.093000+00:00",
        "errors": []
    }
}
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name coredns
+ kubectl scale deployment coredns --replicas=2 -n kube-system
deployment.apps/coredns scaled
++ aws eks describe-cluster --name eks-workshop --region us-west-2 --query cluster.resourcesVpcConfig.clusterSecurityGroupId --output text
+ CLUSTER_SG_ID=sg-0fcabbda9848b346e
+ aws ec2 revoke-security-group-ingress --group-id sg-0fcabbda9848b346e --protocol -1 --port -1 --source-group sg-0fcabbda9848b346e
+ aws ec2 authorize-security-group-ingress --group-id sg-0fcabbda9848b346e --protocol tcp --port 443 --source-group sg-0fcabbda9848b346e
+ aws ec2 authorize-security-group-ingress --group-id sg-0fcabbda9848b346e --protocol tcp --port 10250 --source-group sg-0fcabbda9848b346e
++ date -u
+ echo 'Sun Nov 10 23:15:45 UTC 2024 - Lab Setup Completed'
Sun Nov 10 23:15:45 UTC 2024 - Lab Setup Completed
+ special_echo 'Configuration applied successfully!'
+ echo 'Configuration applied successfully!'
Sat Mar  8 01:09:57 UTC 2025 - Lab Setup Started
+ special_echo 'Applying configuration.'
+ echo 'Applying configuration.'
++ aws eks describe-addon --cluster-name eks-workshop --addon-name kube-proxy --query addon.configurationValues --region us-west-2 --output text
+ output=None
+ [[ None != \{\} ]]
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{}' --resolve-conflicts OVERWRITE
{
    "update": {
        "id": "71c6b67b-1ec1-37bf-9de4-048a27ab37b1",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{}"
            }
        ],
        "createdAt": "2025-03-08T01:10:01.191000+00:00",
        "errors": []
    }
}
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
No resources found
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{"ipvs": {"scheduler": "r"}, "mode": "ipvs"}' --resolve-conflicts OVERWRITE
{
    "update": {
        "id": "43139475-3897-39be-b46d-fd4968d60a55",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"ipvs\": {\"scheduler\": \"r\"}, \"mode\": \"ipvs\"}"
            }
        ],
        "createdAt": "2025-03-08T01:10:10.299000+00:00",
        "errors": []
    }
}
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
No resources found
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy
+ kubectl scale deployment coredns --replicas=0 -n kube-system
deployment.apps/coredns scaled
+ sleep 2
+ aws eks update-addon --cluster-name eks-workshop --region us-west-2 --addon-name coredns --resolve-conflicts OVERWRITE --configuration-values '{"nodeSelector":{"workshop-default":"no"},"replicaCount":0}'
{
    "update": {
        "id": "8f4ef768-6bd2-3bbe-a573-f44079c79f49",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"nodeSelector\":{\"workshop-default\":\"no\"},\"replicaCount\":0}"
            }
        ],
        "createdAt": "2025-03-08T01:10:23.965000+00:00",
        "errors": []
    }
}
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name coredns
+ kubectl scale deployment coredns --replicas=2 -n kube-system
deployment.apps/coredns scaled
++ aws eks describe-cluster --name eks-workshop --region us-west-2 --query cluster.resourcesVpcConfig.clusterSecurityGroupId --output text
+ CLUSTER_SG_ID=sg-08a64b361165ab743
+ aws ec2 revoke-security-group-ingress --group-id sg-08a64b361165ab743 --protocol -1 --port -1 --source-group sg-08a64b361165ab743
+ aws ec2 authorize-security-group-ingress --group-id sg-08a64b361165ab743 --protocol tcp --port 443 --source-group sg-08a64b361165ab743
+ aws ec2 authorize-security-group-ingress --group-id sg-08a64b361165ab743 --protocol tcp --port 10250 --source-group sg-08a64b361165ab743
++ date -u
+ echo 'Sat Mar  8 01:10:37 UTC 2025 - Lab Setup Completed'
Sat Mar  8 01:10:37 UTC 2025 - Lab Setup Completed
+ special_echo 'Configuration applied successfully!'
+ echo 'Configuration applied successfully!'
Tue Mar 11 17:48:21 UTC 2025 - Lab Setup Started
+ special_echo 'Applying configuration.'
+ echo 'Applying configuration.'
++ aws eks describe-addon --cluster-name eks-workshop --addon-name kube-proxy --query addon.configurationValues --region us-west-2 --output text
+ output=None
+ [[ None != \{\} ]]
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{}' --resolve-conflicts OVERWRITE
{
    "update": {
        "id": "96f5c2e8-da63-3a19-82f5-70ef16d7da71",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{}"
            }
        ],
        "createdAt": "2025-03-11T17:48:25.323000+00:00",
        "errors": []
    }
}
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
pod "kube-proxy-htr6z" deleted
pod "kube-proxy-wgw5c" deleted
pod "kube-proxy-wh82k" deleted
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{"ipvs": {"scheduler": "r"}, "mode": "ipvs"}' --resolve-conflicts OVERWRITE
{
    "update": {
        "id": "8f4b13fd-4ceb-3add-a962-d93279a2a151",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"ipvs\": {\"scheduler\": \"r\"}, \"mode\": \"ipvs\"}"
            }
        ],
        "createdAt": "2025-03-11T17:48:35.996000+00:00",
        "errors": []
    }
}
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
pod "kube-proxy-2dcsc" deleted
pod "kube-proxy-ccjc8" deleted
pod "kube-proxy-hj4fg" deleted
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy
+ kubectl scale deployment coredns --replicas=0 -n kube-system
deployment.apps/coredns scaled
+ sleep 2
+ aws eks update-addon --cluster-name eks-workshop --region us-west-2 --addon-name coredns --resolve-conflicts OVERWRITE --configuration-values '{"nodeSelector":{"workshop-default":"no"},"replicaCount":0}'
{
    "update": {
        "id": "33b5d535-035c-38af-940c-7febccfd96a8",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"nodeSelector\":{\"workshop-default\":\"no\"},\"replicaCount\":0}"
            }
        ],
        "createdAt": "2025-03-11T17:48:51.580000+00:00",
        "errors": []
    }
}
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name coredns
+ kubectl scale deployment coredns --replicas=2 -n kube-system
deployment.apps/coredns scaled
++ aws eks describe-cluster --name eks-workshop --region us-west-2 --query cluster.resourcesVpcConfig.clusterSecurityGroupId --output text
+ CLUSTER_SG_ID=sg-04c50794c19fcc21e
+ aws ec2 revoke-security-group-ingress --group-id sg-04c50794c19fcc21e --protocol -1 --port -1 --source-group sg-04c50794c19fcc21e
+ aws ec2 authorize-security-group-ingress --group-id sg-04c50794c19fcc21e --protocol tcp --port 443 --source-group sg-04c50794c19fcc21e
+ aws ec2 authorize-security-group-ingress --group-id sg-04c50794c19fcc21e --protocol tcp --port 10250 --source-group sg-04c50794c19fcc21e
++ date -u
+ echo 'Tue Mar 11 17:49:05 UTC 2025 - Lab Setup Completed'
Tue Mar 11 17:49:05 UTC 2025 - Lab Setup Completed
+ special_echo 'Configuration applied successfully!'
+ echo 'Configuration applied successfully!'
Wed Mar 12 17:33:21 UTC 2025 - Lab Setup Started
+ special_echo 'Applying configuration.'
+ echo 'Applying configuration.'
++ aws eks describe-addon --cluster-name eks-workshop --addon-name kube-proxy --query addon.configurationValues --region us-west-2 --output text

An error occurred (ExpiredTokenException) when calling the DescribeAddon operation: The security token included in the request is expired
+ output=
+ [[ '' != \{\} ]]
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{}' --resolve-conflicts OVERWRITE

An error occurred (ExpiredTokenException) when calling the UpdateAddon operation: The security token included in the request is expired
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
error: You must be logged in to the server (Unauthorized)
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy

Waiter AddonActive failed: An error occurred (ExpiredTokenException): The security token included in the request is expired
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{"ipvs": {"scheduler": "r"}, "mode": "ipvs"}' --resolve-conflicts OVERWRITE

An error occurred (ExpiredTokenException) when calling the UpdateAddon operation: The security token included in the request is expired
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
error: You must be logged in to the server (Unauthorized)
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy

Waiter AddonActive failed: An error occurred (ExpiredTokenException): The security token included in the request is expired
+ kubectl scale deployment coredns --replicas=0 -n kube-system
error: no objects passed to scale
+ sleep 2
+ aws eks update-addon --cluster-name eks-workshop --region us-west-2 --addon-name coredns --resolve-conflicts OVERWRITE --configuration-values '{"nodeSelector":{"workshop-default":"no"},"replicaCount":0}'

An error occurred (ExpiredTokenException) when calling the UpdateAddon operation: The security token included in the request is expired
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name coredns

Waiter AddonActive failed: An error occurred (ExpiredTokenException): The security token included in the request is expired
+ kubectl scale deployment coredns --replicas=2 -n kube-system
error: no objects passed to scale
++ aws eks describe-cluster --name eks-workshop --region us-west-2 --query cluster.resourcesVpcConfig.clusterSecurityGroupId --output text

An error occurred (ExpiredTokenException) when calling the DescribeCluster operation: The security token included in the request is expired
+ CLUSTER_SG_ID=
+ aws ec2 revoke-security-group-ingress --group-id --protocol -1 --port -1 --source-group
+ echo 'Config 1 already applied. Continue reading the rest of lab instructions.'
Config 1 already applied. Continue reading the rest of lab instructions.
+ aws ec2 authorize-security-group-ingress --group-id --protocol tcp --port 443 --source-group
+ echo 'Config 2 already applied. Continue reading the rest of lab instructions.'
Config 2 already applied. Continue reading the rest of lab instructions.
+ aws ec2 authorize-security-group-ingress --group-id --protocol tcp --port 10250 --source-group
+ echo 'Config 3 already applied. Continue reading the rest of lab instructions.'
Config 3 already applied. Continue reading the rest of lab instructions.
++ date -u
+ echo 'Wed Mar 12 17:33:54 UTC 2025 - Lab Setup Completed'
Wed Mar 12 17:33:54 UTC 2025 - Lab Setup Completed
+ special_echo 'Configuration applied successfully!'
+ echo 'Configuration applied successfully!'
Wed Mar 12 19:13:15 UTC 2025 - Lab Setup Started
+ special_echo 'Applying configuration.'
+ echo 'Applying configuration.'
++ aws eks describe-addon --cluster-name eks-workshop --addon-name kube-proxy --query addon.configurationValues --region us-west-2 --output text
+ output='{}'
+ [[ {} != \{\} ]]
+ aws eks update-addon --cluster-name eks-workshop --addon-name kube-proxy --region us-west-2 --configuration-values '{"ipvs": {"scheduler": "r"}, "mode": "ipvs"}' --resolve-conflicts OVERWRITE
{
    "update": {
        "id": "4c6b36ad-f879-3665-8298-6657a062626f",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"ipvs\": {\"scheduler\": \"r\"}, \"mode\": \"ipvs\"}"
            }
        ],
        "createdAt": "2025-03-12T19:13:19.197000+00:00",
        "errors": []
    }
}
+ sleep 2
+ kubectl -n kube-system delete pod -l k8s-app=kube-proxy
pod "kube-proxy-pldx6" deleted
pod "kube-proxy-tz9n7" deleted
pod "kube-proxy-v9zn8" deleted
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name kube-proxy
+ kubectl scale deployment coredns --replicas=0 -n kube-system
deployment.apps/coredns scaled
+ sleep 2
+ aws eks update-addon --cluster-name eks-workshop --region us-west-2 --addon-name coredns --resolve-conflicts OVERWRITE --configuration-values '{"nodeSelector":{"workshop-default":"no"},"replicaCount":0}'
{
    "update": {
        "id": "5ccbb0ea-64b3-381f-bd3b-cddbec548a7a",
        "status": "InProgress",
        "type": "AddonUpdate",
        "params": [
            {
                "type": "ResolveConflicts",
                "value": "OVERWRITE"
            },
            {
                "type": "ConfigurationValues",
                "value": "{\"nodeSelector\":{\"workshop-default\":\"no\"},\"replicaCount\":0}"
            }
        ],
        "createdAt": "2025-03-12T19:13:34.009000+00:00",
        "errors": []
    }
}
+ aws eks wait addon-active --cluster-name eks-workshop --region us-west-2 --addon-name coredns
+ kubectl scale deployment coredns --replicas=2 -n kube-system
deployment.apps/coredns scaled
++ aws eks describe-cluster --name eks-workshop --region us-west-2 --query cluster.resourcesVpcConfig.clusterSecurityGroupId --output text
+ CLUSTER_SG_ID=sg-04c50794c19fcc21e
+ aws ec2 revoke-security-group-ingress --group-id sg-04c50794c19fcc21e --protocol -1 --port -1 --source-group sg-04c50794c19fcc21e
+ aws ec2 authorize-security-group-ingress --group-id sg-04c50794c19fcc21e --protocol tcp --port 443 --source-group sg-04c50794c19fcc21e
+ echo 'Config 2 already applied. Continue reading the rest of lab instructions.'
Config 2 already applied. Continue reading the rest of lab instructions.
+ aws ec2 authorize-security-group-ingress --group-id sg-04c50794c19fcc21e --protocol tcp --port 10250 --source-group sg-04c50794c19fcc21e
+ echo 'Config 3 already applied. Continue reading the rest of lab instructions.'
Config 3 already applied. Continue reading the rest of lab instructions.
++ date -u
+ echo 'Wed Mar 12 19:13:56 UTC 2025 - Lab Setup Completed'
Wed Mar 12 19:13:56 UTC 2025 - Lab Setup Completed
+ special_echo 'Configuration applied successfully!'
+ echo 'Configuration applied successfully!'
